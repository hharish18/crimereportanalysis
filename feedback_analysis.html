{% extends "base.html" %}
{% block content %}
<div class="row g-3">
  <div class="col-md-4">
    <div class="card stat-card">
      <div class="card-body">
        <h6>Average Rating</h6>
        <h3>{{ avg_rating }}</h3>
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card">
      <div class="card-body">
        <h6>Ratings Distribution</h6>
        <canvas id="feedbackChart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="card mt-3">
  <div class="card-body">
    <h6>Feedback Descriptions</h6>
    {% if feedback_items %}
    <div class="table-responsive">
      <table class="table table-striped table-sm mb-0">
        <thead>
          <tr>
            <th>Complaint ID</th>
            <th>Rating</th>
            <th>Description</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          {% for item in feedback_items %}
          <tr>
            <td>{{ item.complaint.complaint_id }}</td>
            <td>{{ item.rating }}</td>
            <td>{{ item.comments or '-' }}</td>
            <td>{{ item.created_at.strftime('%Y-%m-%d %H:%M') if item.created_at else '-' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-muted mb-0">No feedback submitted yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  new Chart(document.getElementById("feedbackChart"), {
    type: "bar",
    data: {
      labels: {{ rating_labels|tojson }},
      datasets: [{ data: {{ rating_data|tojson }}, backgroundColor: "#0d6efd", label: "Count" }]
    }
  });
</script>
{% endblock %}
